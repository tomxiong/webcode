<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç™»å½•è°ƒè¯•é¡µé¢</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 800px; margin: 50px auto; padding: 20px; }
        .container { background: #f9f9f9; padding: 20px; border-radius: 8px; }
        button { background: #3498db; color: white; padding: 10px 20px; border: none; border-radius: 4px; cursor: pointer; margin: 5px; }
        button:hover { background: #2980b9; }
        .log { background: white; padding: 15px; border-radius: 4px; margin-top: 20px; font-family: monospace; font-size: 12px; max-height: 400px; overflow-y: auto; }
        .success { color: #27ae60; }
        .error { color: #e74c3c; }
        .info { color: #3498db; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ”§ ç™»å½•æµç¨‹è°ƒè¯•</h1>
        <p>è¿™ä¸ªé¡µé¢ç”¨äºè°ƒè¯•ç™»å½•é—®é¢˜</p>
        
        <button onclick="testLogin()">æµ‹è¯•ç®¡ç†å‘˜ç™»å½•</button>
        <button onclick="testProfile()">æµ‹è¯•Profileç«¯ç‚¹</button>
        <button onclick="clearStorage()">æ¸…é™¤å­˜å‚¨</button>
        <button onclick="goToDashboard()">è·³è½¬åˆ°ä»ªè¡¨æ¿</button>
        
        <div id="log" class="log"></div>
    </div>

    <script>
        function log(message, type = 'info') {
            const logDiv = document.getElementById('log');
            const timestamp = new Date().toLocaleTimeString();
            const className = type === 'error' ? 'error' : type === 'success' ? 'success' : 'info';
            logDiv.innerHTML += `<div class="${className}">[${timestamp}] ${message}</div>`;
            logDiv.scrollTop = logDiv.scrollHeight;
            console.log(`[${timestamp}] ${message}`);
        }

        async function testLogin() {
            log('å¼€å§‹æµ‹è¯•ç™»å½•...', 'info');
            
            try {
                const response = await fetch('/api/auth/login', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ username: 'admin', password: 'admin123' })
                });
                
                const data = await response.json();
                log(`ç™»å½•å“åº”: ${JSON.stringify(data)}`, response.ok ? 'success' : 'error');
                
                if (response.ok && data.success) {
                    localStorage.setItem('authToken', data.token);
                    localStorage.setItem('userInfo', JSON.stringify(data.user));
                    log('ä»¤ç‰Œå·²ä¿å­˜åˆ°localStorage', 'success');
                    
                    // ç«‹å³æµ‹è¯•profileç«¯ç‚¹
                    await testProfile();
                }
                
            } catch (error) {
                log(`ç™»å½•é”™è¯¯: ${error.message}`, 'error');
            }
        }

        async function testProfile() {
            const token = localStorage.getItem('authToken');
            if (!token) {
                log('æ²¡æœ‰æ‰¾åˆ°ä»¤ç‰Œï¼Œè¯·å…ˆç™»å½•', 'error');
                return;
            }
            
            log('æµ‹è¯•Profileç«¯ç‚¹...', 'info');
            
            try {
                const response = await fetch('/api/auth/profile', {
                    headers: { 'Authorization': 'Bearer ' + token }
                });
                
                const data = await response.json();
                log(`Profileå“åº”: ${JSON.stringify(data)}`, response.ok ? 'success' : 'error');
                
            } catch (error) {
                log(`Profileé”™è¯¯: ${error.message}`, 'error');
            }
        }

        function clearStorage() {
            localStorage.removeItem('authToken');
            localStorage.removeItem('userInfo');
            log('å·²æ¸…é™¤æœ¬åœ°å­˜å‚¨', 'info');
        }

        function goToDashboard() {
            log('è·³è½¬åˆ°ä»ªè¡¨æ¿...', 'info');
            window.location.href = '/dashboard.html';
        }

        // é¡µé¢åŠ è½½æ—¶æ£€æŸ¥çŠ¶æ€
        window.onload = function() {
            log('é¡µé¢åŠ è½½å®Œæˆ', 'info');
            const token = localStorage.getItem('authToken');
            if (token) {
                log('å‘ç°å·²å­˜åœ¨çš„ä»¤ç‰Œ', 'info');
                testProfile();
            } else {
                log('æ²¡æœ‰æ‰¾åˆ°ä»¤ç‰Œ', 'info');
            }
        };
    </script>
</body>
</html>